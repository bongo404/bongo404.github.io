<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial Manager - Bongo404</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #e8e6f0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #f39c12;
            border-bottom: 3px solid #a64b6d;
            padding-bottom: 10px;
        }
        .section {
            background: #16213e;
            border: 2px solid #533a71;
            padding: 20px;
            margin: 20px 0;
        }
        .tutorial-item {
            background: #1a1a2e;
            border: 2px solid #533a71;
            padding: 15px;
            margin: 10px 0;
        }
        .tutorial-item h3 {
            color: #f39c12;
            margin: 0 0 10px 0;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px 0;
            font-weight: bold;
        }
        .published {
            background: #2ecc71;
            color: #000;
        }
        .unpublished {
            background: #e74c3c;
            color: #fff;
        }
        button {
            background: #533a71;
            color: #f39c12;
            border: 2px solid #f39c12;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        button:hover {
            background: #f39c12;
            color: #1a1a2e;
        }
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #c0392b;
        }
        .success {
            background: #2ecc71;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #27ae60;
        }
        .info {
            background: #3498db;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #2980b9;
        }
        pre {
            background: #000;
            color: #0f0;
            padding: 15px;
            overflow-x: auto;
            border: 2px solid #533a71;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-left: 5px solid;
        }
        .test-pass {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }
        .test-fail {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }
    </style>
</head>
<body>
    <h1>üìö Tutorial System Manager</h1>
    
    <div class="section">
        <h2>System Status</h2>
        <div id="systemStatus">Checking...</div>
    </div>

    <div class="section">
        <h2>Available Tutorials</h2>
        <button onclick="loadTutorials()">üîÑ Refresh Tutorials</button>
        <div id="tutorialsList">Loading...</div>
    </div>

    <div class="section">
        <h2>Run Tests</h2>
        <button onclick="runTests()">üß™ Run All Tests</button>
        <div id="testResults"></div>
    </div>

    <div class="section">
        <h2>Quick Actions</h2>
        <button onclick="validateJSON()">‚úì Validate JSON Files</button>
        <button onclick="checkFiles()">üìÅ Check File Structure</button>
        <button onclick="generateReport()">üìä Generate Report</button>
    </div>

    <script>
        let tutorialsData = null;

        // Load tutorials from JSON
        async function loadTutorials() {
            const container = document.getElementById('tutorialsList');
            container.innerHTML = '<p>Loading tutorials...</p>';
            
            try {
                const response = await fetch('../data/tutorials-index.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                tutorialsData = await response.json();
                
                let html = '';
                tutorialsData.tutorials.forEach(tutorial => {
                    const statusClass = tutorial.published ? 'published' : 'unpublished';
                    const statusText = tutorial.published ? 'PUBLISHED' : 'UNPUBLISHED';
                    
                    html += `
                        <div class="tutorial-item">
                            <h3>${tutorial.title}</h3>
                            <div><strong>ID:</strong> ${tutorial.id}</div>
                            <div><strong>Difficulty:</strong> ${tutorial.difficulty}</div>
                            <div><strong>Chapters:</strong> ${tutorial.totalChapters}</div>
                            <div><strong>Category:</strong> ${tutorial.category}</div>
                            <div><strong>Data File:</strong> ${tutorial.dataFile}</div>
                            <span class="status ${statusClass}">${statusText}</span>
                            <div style="margin-top: 10px;">
                                <button onclick="testTutorial('${tutorial.id}')">Test Load</button>
                                <button onclick="openTutorial('${tutorial.id}')">Open Tutorial</button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html || '<p>No tutorials found.</p>';
                updateSystemStatus('success', `‚úì Loaded ${tutorialsData.tutorials.length} tutorials`);
            } catch (error) {
                container.innerHTML = `<div class="error">‚ùå Error loading tutorials: ${error.message}</div>`;
                updateSystemStatus('error', `‚úó Failed to load tutorials`);
            }
        }

        // Test individual tutorial
        async function testTutorial(tutorialId) {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `<p>Testing tutorial: ${tutorialId}...</p>`;
            
            try {
                const response = await fetch(`../data/${tutorialId}.json`);
                if (!response.ok) {
                    throw new Error(`Failed to load ${tutorialId}.json`);
                }
                const data = await response.json();
                
                let results = '<div class="success">‚úì Tutorial JSON loaded successfully!</div>';
                results += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`;
                results += `<div class="info">
                    <strong>Tutorial Details:</strong><br>
                    - Title: ${data.title}<br>
                    - Chapters: ${data.chapters ? data.chapters.length : 0}<br>
                    - Difficulty: ${data.difficulty}
                </div>`;
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Open tutorial in new tab
        function openTutorial(tutorialId) {
            window.open(`tutorial.html?id=${tutorialId}`, '_blank');
        }

        // Run all tests
        async function runTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>Running Tests...</h3>';
            
            let allTests = [];
            
            // Test 1: Check tutorials-index.json
            allTests.push(testIndexFile());
            
            // Test 2: Check each tutorial data file
            if (tutorialsData) {
                for (const tutorial of tutorialsData.tutorials) {
                    allTests.push(testTutorialFile(tutorial.id, tutorial.dataFile));
                }
            }
            
            // Wait for all tests
            const results = await Promise.all(allTests);
            
            let html = '<h3>Test Results:</h3>';
            results.forEach(result => {
                const className = result.passed ? 'test-pass' : 'test-fail';
                const icon = result.passed ? '‚úì' : '‚úó';
                html += `<div class="test-result ${className}">${icon} ${result.message}</div>`;
            });
            
            resultsDiv.innerHTML = html;
        }

        async function testIndexFile() {
            try {
                const response = await fetch('../data/tutorials-index.json');
                if (!response.ok) throw new Error('Index file not found');
                const data = await response.json();
                return { passed: true, message: `tutorials-index.json: Found ${data.tutorials.length} tutorials` };
            } catch (error) {
                return { passed: false, message: `tutorials-index.json: ${error.message}` };
            }
        }

        async function testTutorialFile(id, filename) {
            try {
                const response = await fetch(`../data/${filename}`);
                if (!response.ok) throw new Error('File not found');
                const data = await response.json();
                return { passed: true, message: `${filename}: Valid (${data.chapters ? data.chapters.length : 0} chapters)` };
            } catch (error) {
                return { passed: false, message: `${filename}: ${error.message}` };
            }
        }

        // Validate JSON files
        async function validateJSON() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>Validating JSON files...</p>';
            
            try {
                // Check index
                const indexResponse = await fetch('../data/tutorials-index.json');
                const indexData = await indexResponse.json();
                
                let results = '<div class="success">‚úì tutorials-index.json is valid!</div>';
                
                // Check each tutorial's data file
                for (const tutorial of indexData.tutorials) {
                    try {
                        const tutResponse = await fetch(`../data/${tutorial.dataFile}`);
                        const tutData = await tutResponse.json();
                        results += `<div class="success">‚úì ${tutorial.dataFile} is valid</div>`;
                    } catch (error) {
                        results += `<div class="error">‚úó ${tutorial.dataFile}: ${error.message}</div>`;
                    }
                }
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Validation failed: ${error.message}</div>`;
            }
        }

        // Check file structure
        async function checkFiles() {
            const resultsDiv = document.getElementById('testResults');
            
            const requiredFiles = [
                { path: '../data/tutorials-index.json', name: 'Tutorial Index' },
                { path: '../htmls/tutorial.html', name: 'Tutorial Template' },
                { path: '../htmls/tutorials.html', name: 'Tutorials Page' },
                { path: '../js/tutorial-page.js', name: 'Tutorial Page JS' },
                { path: '../js/tutorials.js', name: 'Tutorials List JS' },
                { path: '../css/tutorial-page.css', name: 'Tutorial Page CSS' },
                { path: '../css/tutorials.css', name: 'Tutorials List CSS' }
            ];
            
            let html = '<h3>File Structure Check:</h3>';
            
            for (const file of requiredFiles) {
                try {
                    const response = await fetch(file.path);
                    if (response.ok) {
                        html += `<div class="test-result test-pass">‚úì ${file.name}: Found</div>`;
                    } else {
                        html += `<div class="test-result test-fail">‚úó ${file.name}: Not found (${file.path})</div>`;
                    }
                } catch (error) {
                    html += `<div class="test-result test-fail">‚úó ${file.name}: Error checking</div>`;
                }
            }
            
            resultsDiv.innerHTML = html;
        }

        // Generate report
        function generateReport() {
            if (!tutorialsData) {
                alert('Please load tutorials first!');
                return;
            }
            
            const report = {
                totalTutorials: tutorialsData.tutorials.length,
                published: tutorialsData.tutorials.filter(t => t.published).length,
                unpublished: tutorialsData.tutorials.filter(t => !t.published).length,
                byDifficulty: {},
                byCategory: {}
            };
            
            tutorialsData.tutorials.forEach(t => {
                report.byDifficulty[t.difficulty] = (report.byDifficulty[t.difficulty] || 0) + 1;
                report.byCategory[t.category] = (report.byCategory[t.category] || 0) + 1;
            });
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `
                <h3>Tutorial System Report</h3>
                <div class="info">
                    <strong>Overview:</strong><br>
                    - Total Tutorials: ${report.totalTutorials}<br>
                    - Published: ${report.published}<br>
                    - Unpublished: ${report.unpublished}<br>
                    <br>
                    <strong>By Difficulty:</strong><br>
                    ${Object.entries(report.byDifficulty).map(([k, v]) => `- ${k}: ${v}`).join('<br>')}
                    <br><br>
                    <strong>By Category:</strong><br>
                    ${Object.entries(report.byCategory).map(([k, v]) => `- ${k}: ${v}`).join('<br>')}
                </div>
            `;
        }

        // Update system status
        function updateSystemStatus(type, message) {
            const statusDiv = document.getElementById('systemStatus');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            statusDiv.innerHTML = `<div class="${className}">${message}</div>`;
        }

        // Initialize on load
        window.addEventListener('load', () => {
            loadTutorials();
        });
    </script>
</body>
</html>